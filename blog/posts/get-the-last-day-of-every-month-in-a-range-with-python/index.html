<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>LexToumbourou.com - Get the last day of every month in a range with Python</title>
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/pygment.css" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//yandex.st/highlightjs/7.3/styles/github.min.css">
    <link rel="alternate" type="application/atom+xml" title="LexToumbourou.com" href="http://lextoumbourou.github.io/atom.xml">

      <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <!--[if lt IE 8]>
        <link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection">
      <![endif]-->
      <script type="text/javascript" src="/theme/js/app.js"></script>
    <noscript>
      <style>
        div.article_body {
          opacity: 1;
        }
        ul.articles {
          opacity: 1;
        }
      </style>
    </noscript>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33772243-5', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="container">

      <div id="header">
        <div id="side-header">
          <a href="/pages/about.html"><img src="https://avatars1.githubusercontent.com/u/1080552?v=3&s=200" width="90" id="main-image"></a>
          <ul>
            <li><a href="https://github.com/lextoumbourou"><i class="fa fa-github fa-1x"></i></a></li>
            <li><a href="https://twitter.com/lexandstuff"><i class="fa fa-twitter fa-1x"></i></a></li>
            <li><a href="https://www.instagram.com/lextoumbourou/"><i class="fa fa-instagram fa-1x"></i></a></li>
            <li><a href="https://au.linkedin.com/in/lextoumbourou"><i class="fa fa-linkedin fa-1x"></i></a></li>
            <li><a href="https://www.youtube.com/user/5footnothingmusic"><i class="fa fa-youtube fa-1x"></i></a></li>
          </ul>
        </div>

        <h1><a href="/">Lex Toumbourou</a></h1>

        <div id="slogan">Python, data, DevOps etc</div>

      </div>

      <hr>

      <div id="content">
<div class="articles">
    <a name="article"></a>
    <article>
        <header class="title">
            <h2>
                Feb 23, 2012.
                <a href="/blog/posts/get-the-last-day-of-every-month-in-a-range-with-python/" rel="bookmark">Get the last day of every month in a range with Python</a>
            </h2>
        </div>

        <div class="article_body">
            </p>

<div class="intro">
I'm building an application that determines what your stock portfolio
was worth every month, factoring in brokerage costs and interest rates,
and compares it to the amount you paid for it (your cost basis). To do
this, I needed to write a method that iterates over a date range and
spits back the last day of each month, then builds a query based on
that.
</div>

<p>I had a few rough ideas on how to go about it but most of them ending up
looking ugly enough to make Baby Jesus weep. People on Stack Overflow
had some ideas, most, of course, better than mine. However, I couldn't
find any that were easy to read and understand.</p>
<p>So, the method I went with was an amalgamation of Vin-G's <a href="http://stackoverflow.com/questions/4039879/best-way-to-find-the-months-between-two-dates-in-python">idea</a> - who
I'm pretty sure makes his mother proud - and some stuff that came out of
reading up on Generators.</p>
<p>It looks like this:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">months_in_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the last day of every month in a range between two datetime values.</span>
<span class="sd">    Return a generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_month</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span>
    <span class="n">end_months</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span>

    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_month</span><span class="p">,</span> <span class="n">end_months</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c"># Get years in the date range, add it to the start date&#39;s year</span>
        <span class="n">year</span> <span class="o">=</span> <span class="p">(</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span> <span class="o">+</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span>
        <span class="n">month</span> <span class="o">=</span> <span class="p">(</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">yield</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<p>The method is called with two date time instances: a start and end date
and is then iterated when called. Like so:</p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">months_in_range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mo">05</span><span class="p">,</span> <span class="mo">01</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()):</span>
    <span class="n">get_cost_basis</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</pre></div>


<p>I also used this code to do the same thing but a return a generator of
years:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">year_iterator</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
</pre></div>


<p><a href="http://www.twitter.com/lexandstuff">Hooray!</a></p>
        </div>
    </article>

<div class="twitter-link">
    <a href="https://twitter.com/lexandstuff">&#x2764;</a>
</div>

</div>
<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lextoumbouroucom'; // Required - Replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></div>
        <hr>
      </div>

    </div>
    <script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>