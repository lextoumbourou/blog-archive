<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>LexToumbourou.com - RSA Animate XBMC Plugin</title>
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/pygment.css" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//yandex.st/highlightjs/7.3/styles/github.min.css">
    <link rel="alternate" type="application/atom+xml" title="LexToumbourou.com" href="http://lextoumbourou.github.io/atom.xml">

      <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <!--[if lt IE 8]>
        <link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection">
      <![endif]-->
      <script type="text/javascript" src="/theme/js/app.js"></script>
    <noscript>
      <style>
        div.article_body {
          opacity: 1;
        }
        ul.articles {
          opacity: 1;
        }
      </style>
    </noscript>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33772243-5', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="container">

      <div id="header">
        <div id="side-header">
          <a href="/pages/about.html"><img src="https://avatars1.githubusercontent.com/u/1080552?v=3&s=200" width="90" id="main-image"></a>
          <ul>
            <li><a href="https://github.com/lextoumbourou"><i class="fa fa-github fa-1x"></i></a></li>
            <li><a href="https://twitter.com/lexandstuff"><i class="fa fa-twitter fa-1x"></i></a></li>
            <li><a href="https://www.instagram.com/lextoumbourou/"><i class="fa fa-instagram fa-1x"></i></a></li>
            <li><a href="https://au.linkedin.com/in/lextoumbourou"><i class="fa fa-linkedin fa-1x"></i></a></li>
            <li><a href="https://www.youtube.com/user/5footnothingmusic"><i class="fa fa-youtube fa-1x"></i></a></li>
          </ul>
        </div>

        <h1><a href="/">Lex Toumbourou</a></h1>

        <div id="slogan">Python, data, DevOps etc</div>

      </div>

      <hr>

      <div id="content">
<div class="articles">
    <a name="article"></a>
    <article>
        <header class="title">
            <h2>
                May 20, 2012.
                <a href="/blog/posts/rsa-animate-xbmc-plugin/" rel="bookmark">RSA Animate XBMC Plugin</a>
            </h2>
        </div>

        <div class="article_body">
            </p>

<div class="intro">
Here's another mini XBMC plugin I've recently developed that allows you
to watch videos from <a href="http://comment.rsablogs.org.uk/videos/">RSA Animate</a> on XBMC.
</div>

</p>

<h3>RSA</h3>
<p><em>The RSA (Royal Society for the encouragement of Arts, Manufactures and Commerce) describes itself as "an enlightenment organisation committed to finding innovative practical solutions to today's social challenges. Through its ideas, research and 27,000-strong Fellowship it seeks to understand and enhance human capability so we can close the gap between today's reality and people's hopes for a better world."</em></p>
<p>If you haven't seen a talk animated by RSA, now is a good time to
<a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=u6XAPnuFjJc">start</a>.</p>
</p>

<h3>The Plugin</h3>
</p>

<p>The plugin itself is very simple. It utilises <a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> to parse
the HTML scraped from the RSA website, and the video content is
collected with a couple of lines.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">scrape_site</span><span class="p">(</span><span class="n">contents</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scrape the RSA Animate Video site and</span>
<span class="sd">    return an array of dictionaries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">contents</span><span class="p">))</span>

    <span class="c"># All the H3s on the page appear to be video titles, let get the title string from each one</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="s">&#39;post&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
        <span class="c"># Clean titles</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">h3</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">string</span>
        <span class="c"># Remove the unneccessary prefix</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;RSA Animate&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
        <span class="c"># Remove white space</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Get the dates</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;postmetadata&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;span&#39;</span><span class="p">,</span> <span class="s">&#39;alignleft&#39;</span><span class="p">)</span>

        <span class="c"># Get the Youtube URLs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;embed&#39;</span><span class="p">)[</span><span class="s">&#39;src&#39;</span><span class="p">]</span>

        <span class="n">final_title</span> <span class="o">=</span> <span class="s">&#39;{0} ({1})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="n">final_title</span><span class="p">,</span>
             <span class="s">&#39;url&#39;</span> <span class="p">:</span> <span class="n">url</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">output</span>
</pre></div>


<p>I <em>love</em> you BeautifulSoup.</p>
</p>

<p>Then, I simply call the add the collection of directory items pointing
to the Youtube plugin.</p>
<div class="highlight"><pre><span class="n">video_list</span> <span class="o">=</span> <span class="n">scraper</span><span class="o">.</span><span class="n">scrape_site</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

<span class="k">for</span> <span class="n">video</span> <span class="ow">in</span> <span class="n">video_list</span><span class="p">:</span>
    <span class="n">xbmc_handler</span><span class="o">.</span><span class="n">add_video_link</span><span class="p">(</span><span class="n">video</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span> <span class="n">video</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">])</span>

<span class="c">#...</span>

<span class="k">def</span> <span class="nf">add_video_link</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Collect just the ID from a Youtube ID, and use it to return an XBMC Directory Item</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># The Youtube ID is the 4th value with array split</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>

    <span class="c"># URL to call the Youtube plugin</span>
    <span class="n">youtube_url</span> <span class="o">=</span> <span class="s">&#39;plugin://plugin.video.youtube?action=play_video&amp;videoid=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="c"># Create a new XBMC List Item and provide the title</span>
    <span class="n">list_item</span> <span class="o">=</span> <span class="n">xbmcgui</span><span class="o">.</span><span class="n">ListItem</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">list_item</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&#39;IsPlayable&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xbmcplugin</span><span class="o">.</span><span class="n">addDirectoryItem</span><span class="p">(</span><span class="n">__addon_id_int__</span><span class="p">,</span> <span class="n">youtube_url</span><span class="p">,</span> <span class="n">list_item</span><span class="p">)</span>
</pre></div>


<h3>Installation and Support</h3>
</p>

<p>The plugin is not in the official repository just yet. I think, for it
to be worthy, I'll need to extend it to cover the wealth of video
content on the <a href="http://www.thersa.org">RSA site</a> beyond just the [Animate section][RSA
Animate]. But, it's simple to download and install via <a href="https://github.com/lextoumbourou/plugin.video.rsa_animate">Github</a>.</p>
</p>

<p>For support and discussion, please use the official <a href="http://forum.xbmc.org/showthread.php?tid=128173">XBMC forum</a>.</p>
</p>
        </div>
    </article>

<div class="twitter-link">
    <a href="https://twitter.com/lexandstuff">&#x2764;</a>
</div>

</div>
<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lextoumbouroucom'; // Required - Replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></div>
        <hr>
      </div>

    </div>
    <script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>