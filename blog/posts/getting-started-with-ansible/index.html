<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>LexToumbourou.com - Getting Started With Ansible</title>
    <link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/theme/css/pygment.css" />
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//yandex.st/highlightjs/7.3/styles/github.min.css">
    <link rel="alternate" type="application/atom+xml" title="LexToumbourou.com" href="http://lextoumbourou.github.io/atom.xml">

      <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <!--[if lt IE 8]>
        <link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection">
      <![endif]-->
      <script type="text/javascript" src="/theme/js/app.js"></script>
    <noscript>
      <style>
        div.article_body {
          opacity: 1;
        }
        ul.articles {
          opacity: 1;
        }
      </style>
    </noscript>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33772243-5', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="container">

      <div id="header">
        <div id="side-header">
          <a href="/pages/about.html"><img src="https://avatars1.githubusercontent.com/u/1080552?v=3&s=200" width="90" id="main-image"></a>
          <ul>
            <li><a href="https://github.com/lextoumbourou"><i class="fa fa-github fa-1x"></i></a></li>
            <li><a href="https://twitter.com/lexandstuff"><i class="fa fa-twitter fa-1x"></i></a></li>
            <li><a href="https://www.instagram.com/lextoumbourou/"><i class="fa fa-instagram fa-1x"></i></a></li>
            <li><a href="https://au.linkedin.com/in/lextoumbourou"><i class="fa fa-linkedin fa-1x"></i></a></li>
            <li><a href="https://www.youtube.com/user/5footnothingmusic"><i class="fa fa-youtube fa-1x"></i></a></li>
          </ul>
        </div>

        <h1><a href="/">Lex Toumbourou</a></h1>

        <div id="slogan">Python, data, DevOps etc</div>

      </div>

      <hr>

      <div id="content">
<div class="articles">
    <a name="article"></a>
    <article>
        <header class="title">
            <h2>
                Feb 04, 2013.
                <a href="/blog/posts/getting-started-with-ansible/" rel="bookmark">Getting Started With Ansible</a>
            </h2>
        </div>

        <div class="article_body">
            <p>

<div class="intro">
This weekend I decided to fix the mess that was my side-project
production environment. I had 3 Linode VMs running 3 or 4 production
websites and a couple of websites in development scattered haphazardly.
There was a Postgres instance wasting cycles on each and no unity across
configs. 

So, I decided I was going to implement some form of automated
configuration management. Tools like Puppet or Chef seemed like
reasonable options, especially since we use Puppet at work, but I have
been wanting to play with Ansible for a while and this seemed like a
good opportunity.
</div>

</p>

<ul>
<li><a href="#why-ansible">Why Ansible?</a>  </li>
<li><a href="#requirements">My Requirements</a>  </li>
<li><a href="#part-1">Part 1: Preparing my Inventory</a>  </li>
<li><a href="#part-2">Part 2: Configuring Users and Groups with Modules</a>  </li>
<li><a href="#part-3">Part 3: Automating Tasks Using Playbooks</a>  </li>
<li><a href="#part-4">Part 4: Using Templates To Setup Privileges and SSH Security</a>  </li>
<li><a href="#part-5">Part 5: Source Control</a>  </li>
<li><a href="#summary">Summary</a>  </li>
</ul>
<hr />
<p><a name="why-ansible"></a></p>
<h3><a href="#why-ansible">Why Ansible?</a></h3>
<p>In short: simplicity. Ansible is the kind of tool that you just pick up
and use; the learning curve is minimal. All the communication is handled
via vanilla SSH so there's no clients to install and it uses a push
system for deploying changes, so no central server is required. This
makes the configs portable and the setup costs low. The Playbooks (like
Cookbooks in Chef) are written in YAML and the template engine uses
Jinja2 - tools I'm very familiar with. Lastly, and perhaps for me the
biggest draw card, the source code is written in Python.</p>
<p><a name="requirements"></a></p>
<h3><a href="#requirements">My Requirements</a></h3>
<p>Before beginning my Ansible journey, I set aside some goals to guide the
process:</p>
<ol>
<li>I should never, <em>ever</em> have to log into a production server to
    configure it. That means everything down to the first user account
    should be handled by Ansible.</li>
<li>Everything configured should be completely self documenting. If I
    come back to them after a year, it should be very clear what
    everything does.</li>
<li>The entire system should be extremely portable. Any time I need to
    rebuild my development server, the configs should just be a
    <code>git pull</code> away.</li>
</ol>
<p>Which that in mind, I documented the steps I followed to get the basics
up and running: user accounts, groups, sshd_config and sudoers. I have
been able to get much further than this in a very short period of time
(thanks largely to Ansible's excellent documentation and ease of use),
in the interest of brevity, let's keep it...brief.</p>
<hr />
<p><a name="part-1"></a></p>
<h3><a href="#part-1">Part 1: Preparing my Inventory</a></h3>
<p>I started by creating a new Ubuntu VM at Linode and setting a default
password.</p>
<p>Then, on my development machine, I installed Ansible's prerequisties:
<a href="http://pyyaml.org/">PyYAML</a>, <a href="http://jinja.pocoo.org/docs/">Jinja2</a> and <a href="http://www.lag.net/paramiko/">Paramiko</a>.</p>
<div class="highlight"><pre>lex@desktop:~&gt; sudo pip install pyyaml jinja2 paramiko
</pre></div>


<p><em>Note: it is trivial to run Ansible in a <a href="http://www.virtualenv.org/en/latest/">virtualenv</a> container and
generally a good idea. For simplicity sake, I've skipped those steps
here.</em></p>
<p>Next, following Ansible's <a href="http://ansible.cc/docs/gettingstarted.html#contents">install instructions</a>, I cloned the repo,
checking out the latest stable branch and installed it using
<a href="http://docs.python.org/2/distutils/index.html">distutils</a>.</p>
<div class="highlight"><pre>lex@desktop:~&gt; <span class="nb">cd </span>src
lex@desktop:~/src&gt; git clone -b release0.9 git://github.com/ansible/ansible.git
lex@desktop:~/src&gt; <span class="nb">cd </span>ansible
lex@desktop:~/src/ansible&gt; sudo python setup.py install
</pre></div>


<p>After, I created the <code>/etc/ansible/</code> directory which housed my first
<a href="http://ansible.cc/docs/patterns.html#hosts-and-groups">hosts</a> file, initially just listing my created VM (but would soon
list all my servers in production).</p>
<h5>/etc/ansible/hosts</h5>
<div class="highlight"><pre><span class="k">[webservers]</span>
<span class="err">prodweb03</span>
</pre></div>


<p>The host file can also include additional per-host and per-group
variables which are useful for configuring things like network settings
and so on. Consult the <a href="http://ansible.cc/docs/patterns.html">Inventory and Patterns</a> section of the doco
for more info.</p>
<p>I then tested connectivity to the web servers using the <code>ping</code> module
(more on Ansible's modules and syntax later).</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; ansible all -m ping -u root --ask-pass
SSH password:
prodweb03 | success &gt;&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: <span class="nb">false</span>,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
</pre></div>


<p><a name="part-2"></a></p>
<h3><a href="#part-2">Part 2: Configuring Users and Groups with Modules</a></h3>
<p>Ansible has a reasonable library of modules built-in which can be
executed via Playbooks or directly via the command line. The latter's
<a href="http://ansible.cc/docs/examples.html">syntax</a> looks a bit like this:</p>
<div class="highlight"><pre>lex@desktop:~&gt; ansible &lt;host_pattern&gt; -m &lt;module_name&gt; -a &lt;module_args&gt; &lt;additional_args&gt;
</pre></div>


<p>For example, I can utilise the <code>command</code> module to run <code>uptime</code> across
my hosts.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; ansible webservers -m <span class="nb">command</span> -a <span class="s2">&quot;uptime&quot;</span> -u root --ask-pass
SSH password:
prodweb03 | success | <span class="nv">rc</span><span class="o">=</span>0 &gt;&gt;
 06:55:23 up 12 min,  1 user,  load average: 0.00, 0.01, 0.01
</pre></div>


<p><em>Note that by default, Ansible attempts to perform operations as the
local user, using public key authentication. Since I don't have any
users setup remotely just yet, nor any keys, I'll have to explicitly run
the command as root (<code>-u root</code>) forcing a password prompt
(<code>--ask-pass</code>).</em></p>
<p>To start the configuration process, I configured my user accounts using
the <code>group</code> and <code>user</code> modules, with the intention of later moving the
commands to Playbooks.</p>
<p>Here I created a group called <code>admin</code>, with a GID of 1000.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; ansible webservers -m group -a <span class="s2">&quot;gid=1000 name=admin state=present&quot;</span> -u root --ask-pass
</pre></div>


<p>Hopefully, the arguments I'm passing to the module are self-explanatory.
If not, consult the amazingly simple <a href="http://ansible.cc/docs/modules.html">documentation</a>.</p>
<p>Next, I created my user account with the <code>user</code> module, and uploaded my
<code>authorized_key</code> file using the module with the same name.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; ansible webservers -m user -a <span class="se">\</span>
                          <span class="s2">&quot;name=lex group=admin shell=/bin/bash uid=1000&quot;</span> -u root --ask-pass
lex@desktop:/etc/ansible&gt; ansible webservers -m authorized_key -a <span class="se">\</span>
                          <span class="s2">&quot;user=lex key=&#39;$(cat ~/.ssh/id_rsa.pub)&#39;&quot;</span> -u root --ask-pass
</pre></div>


<p>Now, since I have <code>ssh-agent</code> running, I can perform commands across the
server(s) as myself.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; ansible webservers -m <span class="nb">command</span> -a <span class="s2">&quot;uptime&quot;</span>
prodweb03 | success | <span class="nv">rc</span><span class="o">=</span>0 &gt;&gt;
 07:31:47 up 48 min,  1 user,  load average: 0.00, 0.01, 0.02
</pre></div>


<p><a name="part-3"></a></p>
<h3><a href="#part-3">Part 3: Automating Tasks Using Playbooks</a></h3>
<p>Playbooks are <a href="http://www.yaml.org/">YAML</a> configuration files that define a set of tasks or
<em>Plays</em> to be executed on the remote server. Following Ansible's <a href="http://ansible.cc/docs/bestpractices.html">Best
Practises</a> document, I created a <code>company_name</code> directory to house my
Playbooks and additional files. Then, I created the first Playbook,
<code>initial.yml</code>, where I would store the user and group creation tasks I
ran manually earlier.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible&gt; mkdir lexandstuff
lex@desktop:/etc/ansible&gt; <span class="nb">cd </span>lexandstuff/
lex@desktop:/etc/ansible/lexandstuff&gt; vi initial.yml
</pre></div>


<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">webservers</span>
  <span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>

  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>

    <span class="c1"># ===============================================================</span>
    <span class="c1"># Configure user&#39;s and groups</span>
    <span class="c1"># ===============================================================</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">create admin group</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group name=admin gid=1000 system=no</span>

    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">create user(s)</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user name=lex group=admin shell=/bin/bash uid=1000</span>

    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">setup authorized key(s)</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">authorized_key user=lex key=&#39;$FILE(/home/lex/.ssh/id_rsa.pub)&#39;</span>
</pre></div>


<p>The syntax is quite self-explanatory: <code>hosts</code> represents the group of
servers this Playbook will refer to. <code>sudo</code> defines whether or not we'll
run the commands using sudo. Then, in the <code>tasks</code> section, <code>name</code> is the
human-readable task description that appears on the command line while
the Playbook is running. Clearly then, <code>action</code> represents the actual
task.</p>
<p>With that complete, I can now run the Playbook at the prompt and watch
the magic happen.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible/lexandstuff&gt; ansible-playbook initial.yml -u root --ask-pass
SSH password:

PLAY <span class="o">[</span>webservers<span class="o">]</span> *********************

GATHERING FACTS *********************
ok: <span class="o">[</span>prodweb03<span class="o">]</span>

TASK: <span class="o">[</span>create group<span class="o">(</span>s<span class="o">)]</span> *********************
ok: <span class="o">[</span>prodweb03<span class="o">]</span>

TASK: <span class="o">[</span>create user<span class="o">(</span>s<span class="o">)]</span> *********************
ok: <span class="o">[</span>prodweb03<span class="o">]</span>

TASK: <span class="o">[</span>setup authorized key<span class="o">(</span>s<span class="o">)]</span> *********************
ok: <span class="o">[</span>prodweb03<span class="o">]</span>

PLAY RECAP *********************
prodweb03                      : <span class="nv">ok</span><span class="o">=</span>4    <span class="nv">changed</span><span class="o">=</span>0    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0
</pre></div>


<p>Perhaps at some stage I expect to require more than just a single
account and user group on my production web servers. One way to handle
it, is to just list additionally actions in order.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre>    <span class="c1">#...</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">create admin group</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group name=admin gid=1000 system=no</span>

    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">create sshusers group</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">group name=sshusers gid=1001 system=no</span>
    <span class="c1">#...</span>
</pre></div>


<p>Or, I could separate a repeatable task into a <a href="http://ansible.cc/docs/playbooks.html#include-files-and-encouraging-reuse">separate file</a> and call
it from within my main Playbook.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre>   <span class="c1">#...</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tasks/create_user.yml user=lex group=admin full_name=&#39;Lex Toumbourou&#39; uid=1000</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tasks/create_user.yml user=travis group=sshusers full_name=&#39;Travis Bickle&#39; uid=1001</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">include</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tasks/create_user.yml user=jacob group=sshusers full_name=&#39;Jacob Singer&#39; uid=1002</span>
   <span class="c1">#...</span>
</pre></div>


<h5>/etc/ansible/lexandstuff/tasks/create_user.yml</h5>
<div class="highlight"><pre><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">create user(s)</span>
  <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user name=$user group=$group shell=/bin/bash uid=$uid</span>

<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">setup authorized key(s)</span>
  <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">authorized_key user=$user key=&#39;$FILE(/home/$user/.ssh/id_rsa.pub)&#39;</span>
</pre></div>


<p><a name="part-4"></a></p>
<h3><a href="#part-4">Part 4: Using Templates To Setup Privileges and SSH Security</a></h3>
<p>Ansible relies on the very powerful Jinja2 engine to handle templating.
In this last part of the tutorial, I'm going to utilise templates to
create a custom sudoers file, allowing me to run commands on the remote
hosts as myself, and a customised sshd config.</p>
<p>Firstly, I created the templates directory and wrote the custom sudoers
template. You may note that initially, I'm not taking advantage of the
templating engine at all. I could have simply used the <code>copy</code> module to
copy the file up to my server, but this gives me a chance to extend it
later.</p>
<h5>/etc/ansible/lexandstuff/templates/custom_sudo.j2</h5>
<div class="highlight"><pre><span class="c1"># Members of the admin group may gain root privileges</span>
<span class="err">%</span><span class="l-Scalar-Plain">admin ALL=(ALL) NOPASSWD:ALL</span>
</pre></div>


<p>Now, I can import add the creation of <code>/etc/sudoers.d/custom</code> into the
Playbook.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre>  <span class="c1">#...</span>

  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>

    <span class="c1">#...</span>

    <span class="c1"># ===============================================================</span>
    <span class="c1"># Access, security and permissions</span>
    <span class="c1"># ===============================================================</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">write the sudoers file</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template src=templates/sudoers.j2 dest=/etc/sudoers.d/custom</span>
                 <span class="l-Scalar-Plain">owner=root group=root mode=0400</span>
   <span class="c1">#...</span>
</pre></div>


<p>Now, for my <code>sshd_config</code>, I created another template with placeholders
for the variables configured in the Playbook, using Jinja2's
<code>{{ variable_name }}</code> syntax.</p>
<h5>/etc/ansible/lexandstuff/templates/sshd_config.j2</h5>
<div class="highlight"><pre><span class="l-Scalar-Plain">Port {{ ssh_port }}</span>

<span class="l-Scalar-Plain">Protocol {{ ssh_protocol }}</span>

<span class="l-Scalar-Plain">#...</span>

<span class="l-Scalar-Plain">RSAAuthentication {{ ssh_rsa_authentication }}</span>
<span class="l-Scalar-Plain">PubkeyAuthentication {{ ssh_public_key_authentication }}</span>

<span class="l-Scalar-Plain">#...</span>
</pre></div>


<p>And, so on.</p>
<p>In a separate <code>vars</code> file, I specified the variables...</p>
<h5>/etc/ansible/lexandstuff/vars/defaults.yml</h5>
<div class="highlight"><pre><span class="c1">########################</span>
<span class="c1"># sshd_config settings</span>
<span class="c1">########################</span>

<span class="l-Scalar-Plain">ssh_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">22</span>
<span class="l-Scalar-Plain">ssh_protocol</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
<span class="l-Scalar-Plain">ssh_syslog_facility</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AUTH</span>

<span class="c1">#...</span>

<span class="c1"># Allow authentication methods</span>
<span class="l-Scalar-Plain">ssh_rsa_authentication</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
<span class="l-Scalar-Plain">ssh_public_key_authentication</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>

<span class="c1">#...</span>
</pre></div>


<p>...which were included in the Playbook using the <code>vars_files</code> parameter.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre><span class="c1"># ...</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">all</span>
  <span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
  <span class="l-Scalar-Plain">gather_facts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">no</span>
  <span class="l-Scalar-Plain">vars_file</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">vars/defaults.yml</span>

  <span class="-Error"> </span><span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
<span class="c1"># ...</span>
</pre></div>


<p>Then, I just call the <code>template</code> module to create the <code>sshd_config</code>
file.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre><span class="c1"># ...</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">write the sshd_config file</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template src=templates/sshd_config.j2 dest=/etc/ssh/sshd_config</span>
              <span class="l-Scalar-Plain">owner=root group=root mode=0644</span>
</pre></div>


<p>In order for the changes to take effect, we're going to need to reload
the ssh daemon after changing the config. That can be done with a
<code>handler</code>. A handler is a list of tasks that another task can call or
"notify" to perform after the Playbook has finished executing. So, in
the config, I've added a handler section toward the bottom which uses
the <code>service</code> module to reload the config.</p>
<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre><span class="c1">#...</span>
  <span class="l-Scalar-Plain">handlers</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">reload sshd</span>
      <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service name=ssh state=reloaded</span>
</pre></div>


<p>Then, using the <code>notify</code> parameter, I can call the handler after the
sshd config file is generated.</p>
</p>

<h5>/etc/ansible/lexandstuff/initial.yml</h5>
<div class="highlight"><pre><span class="c1">#...</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">write the sshd_config file</span>
  <span class="l-Scalar-Plain">action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">template src=templates/sshd_config.j2 dest=/etc/ssh/sshd_config</span>
          <span class="l-Scalar-Plain">owner=root group=root mode=0644</span>
  <span class="l-Scalar-Plain">notify</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">reload sshd</span>
</pre></div>


<p>And we're done.</p>
<p><a name="part-5"></a></p>
<h3><a href="#part-5">Part 5: Source Control</a></h3>
<p>Lastly, I put my entire repo in source control.</p>
<div class="highlight"><pre>lex@desktop:/etc/ansible/lexandstuff&gt; git init
Initialized empty Git repository in /etc/ansible/lexandstuff/.git/
lex@desktop:/etc/ansible/lexandstuff&gt; git add .
lex@desktop:/etc/ansible/lexandstuff&gt; git commit -m <span class="s2">&quot;First working version configures basic environment&quot;</span>
</pre></div>


<p>I then pushed it to a private repo on GitHub, which means that I have
access to them from anywhere.</p>
<p><a name="summary"></a></p>
<h3><a href="#summary">Summary</a></h3>
<p>In conclusion, Ansible is awesome. Straight-forward, easy,
self-documenting and, dare I say it, fun. If you're finding yourself
putting off automating configuration management because you're fearing a
steep learning curve, then Ansible is probably for you.</p>
        </div>
    </article>

<div class="twitter-link">
    <a href="https://twitter.com/lexandstuff">&#x2764;</a>
</div>

</div>
<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lextoumbouroucom'; // Required - Replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></div>
        <hr>
      </div>

    </div>
    <script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>